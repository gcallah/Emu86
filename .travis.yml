language: python
python:
    - '3.6'

services:
    - docker

addons:
    ssh_known_hosts: ssh.pythonanywhere.com

before_install:
   - openssl aes-256-cbc -K $encrypted_509cf6f5306c_key -iv $encrypted_509cf6f5306c_iv -in id_rsa.enc -out ~/.ssh/id_rsa -d

install:
    - pip install -r docker/requirements.txt

env:
    - PYTHONPATH=/home/travis/build/gcallah/Emu86

script:
    - make tests
    - python setup.py sdist

after_success:
   - cd /home/travis/build/gcallah/Emu86; ./deploy.sh

deploy:
  provider: pypi
  user: __token__
  password:
    secure: pypi-AgEIcHlwaS5vcmcCJGJkMWI4MDZlLWZhNzYtNDAzYS05Zjg1LWY1NjQzNGRhNjQzOAACNnsicGVybWlzc2lvbnMiOiB7InByb2plY3RzIjogWyJlbXU4NiJdfSwgInZlcnNpb24iOiAxfQAABiCEItWZICaxU_6V5YswU17-nDk41KPe6DdyHeQGEeA31Q
  on:
    branch: master
    condition: $TRAVIS_COMMIT_MESSAGE == "pypi release v"*

notifications:
  slack: emu86:PJWVpwvXaU6dpB2VeD6UuBzf
